<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VR mini game</title>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-physics-system@4.0.1/dist/aframe-physics-system.min.js"></script>
</head>
 <body>
    <a-scene physics="debug: false" vr-mode-ui="enabled: true">
        <a-sky color="#00FFFF"></a-sky>

        <a-plane position="0 0 -4" rotation="-90 0 0" width="10" height="10" color="#228B22"></a-plane>

        <a-entity id="player" movement-controls="speed: 0.1" position="0 1.6 5" kinematic-body>
            <a-camera>
                <a-cursor fuse="true" fuse-timeout="500"></a-cursor>
            </a-camera>
        </a-entity>

        <a-box id="box1" collectible position="-3 0.5 -3" rotaiton="0 45 45" color="#9932CC" static-body dynamic-body="mass: 1"></a-box>
        <a-sphere id="sphere1" collectible position="3 1.25 -5" radius="1.25" color="#EF2D5E" dynamic-body="mass: 1"></a-sphere>
        <a-cylinder id="cylinder1" collectible position="0 0.75 -5" radius="0.5" height="1.5" color="#FFC65D" dynamic-body="mass: 1"></a-cylinder>
        <a-cone id="cone1" collectible position="0 1 -3" rotation="0 45 45" color="#00FF22" scale="0.5 1 0.5" dynamic-body="mass: 1"></a-cone>
        <a-sphere id="sphere2" collectible position="1 1 -3" rotation="0 65 65" color="#999" 
         animation="property: position; to: 1 3 -5; dur: 2000; easing: linear; loop: true" scale="0.5 0.5 0.5" dynamic-body="mass: 1"></a-sphere>
        <a-cylinder id="cylinder2" collectible position="-1 1 -3" rotation="0 0 0" color="#999" 
         animation="property: rotation; to: 0 360 360; loop: true; dur: 10000" scale="0.5 2 0.5" dynamic-body="mass: 1"></a-cylinder>
        <a-sphere id="sphere3" collectible position="-2 2 -6" rotation="0 45 45" color="#8B4513" dynamic-body="mass: 1"></a-sphere>
        <a-cone id="cone2" collectible position="0 1 -6" rotation="0 45 45" scale="0.5 1 0.5" dynamic-body="mass: 1"></a-cone>
        <a-box id="box2" collectible position="-3 1 -5" rotation="0 45 45" color="#8B4513" dynamic-body="mass: 1"></a-box>
        <a-cone id="cone3" collectible position="0 3 -6" color="#FFFF00" dynamic-body="mass: 1"></a-cone>

        <a-entity 
            gltf-model="https://cdn.aframe.io/test-models/models/Tree/cloud_tree.glb"
            position="0 0 -20"
            scale="2 2 2"
            static-body
        ></a-entity>

        <a-text id="scoreText" value="Score: 0" position="-1.5 2.5 -5" color="black" static-body></a-text>

        <a-text id="timerText" value="Time: 60" position="1.5 2.5 -5" color="black" static-body></a-text>
        
        <a-entity id="gameOverPanel" visible="false">
            <a-plane 
                position="0 1.5 -1.5" 
                width="4" 
                height="2" 
                color="#333333" 
                opacity="0.9"
            ></a-plane>
            <a-text 
                id="gameOverText"
                value="Игра окончена!\nСчет: 0"
                position="0 2 -1.5"
                color="#FF0000"
                align="center"
                width="6"
            ></a-text>
            <a-text 
                id="restartText"
                value="Кликни чтобы\nперезапустить"
                position="0 1.3 -1.5"
                color="#00FF00"
                align="center"
                width="6"
            ></a-text>
        </a-entity>
    </a-scene>

    <script>
        let score = 0;
        let timeLeft = 60;
        let timerElement;
        const totalObjects = 10;
        let gameActive = true;

        AFRAME.registerComponent('collectible', {
            init: function () {
                this.collected = false;
                
                this.el.addEventListener('click', () => {
                    if (!gameActive || this.collected) return;
                    this.collectObject();
                });
                this.el.addEventListener('collide', (e) => {
                    if (!gameActive || this.collected) return;
                    
                    const player = document.querySelector('#player');
                    if (e.detail.body.el === player) {
                        this.collectObject();
                    }
                });
            },

            collectObject: function () {
                this.collected = true;
                
                const el = this.el;
                el.setAttribute('visible', 'false');
                el.parentNode.removeChild(el);
                
                score++;
                document.querySelector('#scoreText').setAttribute('value', `Score: ${score} / ${totalObjects}`);

                if (score === totalObjects) {
                    endGame(true);
                }
            }
        });

        function initGame() {
            score = 0;
            timeLeft = 60;
            gameActive = true;

            document.querySelector('#scoreText').setAttribute('value', `Score: ${score} / ${totalObjects}`);
            document.querySelector('#timerText').setAttribute('value', `Time: ${timeLeft}`);
            document.querySelector('#gameOverPanel').setAttribute('visible', 'false');

            
        }

        function updateTimer() {
            if (!gameActive) return;

            timeLeft--;
            document.querySelector('#timerText').setAttribute('value', `Time: ${timeLeft}`);

            if (timeLeft <= 0) {
                endGame(false);
            }
        }

        setInterval(updateTimer, 1000);


        function endGame() {
            gameActive = false;
            document.querySelector('#gameOverText').setAttribute('value', message);
            document.querySelector('#gameOverPanel').setAttribute('visible', 'true');

            document.querySelector('#gameOverPanel').addEventListener('click', () => {
                location.reload();
            });
            alert('Game Over! Your final score is: ' + score);
        }

        window.onload = initGame;
    </script>
</body>
</html>